<div class="audit-report-container">
  <!-- Header Section -->
  <div class="header-section">
    <h1 class="page-title">Audit Report Library</h1>
    <button class="btn btn-add-report" [matMenuTriggerFor]="addMenu">
      <i class="bi bi-plus"></i>
      Add Report
    </button>
    <mat-menu #addMenu="matMenu" class="add-report-menu">
      <button mat-menu-item (click)="onUploadReport()">
        <i class="bi bi-upload me-2"></i>
        Upload Report
      </button>
      <button mat-menu-item (click)="onCreateReport()">
        <i class="bi bi-pencil-square me-2"></i>
        Create Report
      </button>
    </mat-menu>
  </div>

  <!-- Search and Filter Section -->
  <div class="controls-section">
    <div class="search-wrapper">
      <div class="search-input-group">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Search reports..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
        >
        <button
          *ngIf="searchTerm"
          class="clear-search-btn"
          type="button"
          (click)="onClearSearch()"
          title="Clear search">
          <i class="bi bi-x-circle"></i>
        </button>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-filter" (click)="onFilter()">
        <i class="bi bi-funnel"></i>
        Filter
      </button>
      <button class="btn btn-download" (click)="onDownloadReport()">
        <i class="bi bi-download"></i>
        Download Report
      </button>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-section">
    <app-reusable-table 
      [tableData]="getCurrentPageReports()" 
      [isLoading]="isLoadingReports"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [totalCount]="totalCount"
      [hasNextPage]="hasNextPage"
      [hasPreviousPage]="hasPreviousPage"
      [showPagination]="true"
      (nextPage)="onNextPage()"
      (previousPage)="onPreviousPage()">
      <ng-template #headers>
        <th>
          <span>Report</span>
        </th>
        <th>
          <span>Entity</span>
        </th>
        <th>
          <span>Overall Rating</span>
        </th>
        <th>
          <span>Other Unique Identifier</span>
        </th>
        <th>
          <span>Quarter</span>
        </th>
        <th>
          <span>Audit Name</span>
        </th>
        <th>
          <span>Action</span>
        </th>
      </ng-template>

      <ng-template #rows let-report>
        <td>
          <div class="report-info">
            <div class="report-id">{{ report.reportNumber }}</div>
            <div class="report-date">{{ report.reportDate | dateFormat }}</div>
          </div>
        </td>
        <td>
          {{ report.entity || "--" }}
        </td>
        <td>
          <span class="rating-badge" [style.color]="getRatingColor(report.overallRating)">
            <span class="rating-dot">‚óè</span>
            {{ getRatingType(report.overallRating) }}
          </span>
        </td>
        <td>
          {{ report.otherUniqueIdentifier || "--" }}
        </td>
        <td>
          {{ report.quarter || "--" }}
        </td>
        <td>
          {{ report.auditName || "--" }}
        </td>
        <td>
          <div class="dropdown">
            <a
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="bi bi-three-dots-vertical"></i>
            </a>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  (click)="onEditReport(report)"
                  href="javascript:void(0)"
                >
                  <small>Edit report</small>
                </a>
                <a
                  class="dropdown-item"
                  (click)="onFreezeReport(report)"
                  href="javascript:void(0)"
                >
                  <small>Restrict viewing/ Freeze report</small>
                </a>
                <a
                  class="dropdown-item"
                  (click)="onAddComment(report)"
                  href="javascript:void(0)"
                >
                  <small>Add comment</small>
                </a>
              </li>
            </ul>
          </div>
        </td>
      </ng-template>
    </app-reusable-table>
  </div>

  <!-- Add/Edit Report Modal -->
  <app-side-modal
    [isOpen]="showAddReportModal"
    [title]="isEditMode ? 'Edit Report' : 'Add Report'"
    description="Fill details below to add a finding to a report"
    (close)="onAddReportClose()">
    <app-add-report-form
      [reportData]="selectedReportForEdit"
      [isEditMode]="isEditMode"
      (submit)="onAddReportSubmit($event)"
      (close)="onAddReportClose()">
    </app-add-report-form>
  </app-side-modal>

  <!-- Comment Modal -->
  <app-side-modal
    [isOpen]="showCommentModal"
    [title]="'Comments'"
    (close)="onCommentClose()">
    <app-audit-library-comment
      [report]="selectedReportForComment"
      (close)="onCommentClose()">
    </app-audit-library-comment>
  </app-side-modal>
</div>
